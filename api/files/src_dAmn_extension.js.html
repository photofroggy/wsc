<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>wsc documentation</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <!--<link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">-->
    <link rel="stylesheet" href="/wsc/css/main.css">
    <link rel="stylesheet" href="/wsc/css/features.css">
    <link rel="stylesheet" href="/wsc/css/docs.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
    <script type="text/javascript" src="/wsc/js/zepto.js"></script>
</head>
<body>
    <div class="squeeze">
        <nav class="menu">
            <ul>
                <li><a href="/wsc/">wsc</a></li>
                <li><a href="/wsc/damn/">wsc.dAmn</a></li>
                <li><a href="/wsc/extensions/">making extensions</a></li>
                <li><a href="/wsc/api/" class="active">api documentation</a></li>
            </ul>
        </nav>
        <nav class="contents">
    <h3>Classes</h3>
    <ul>
    
        <li><a href="/wsc/api/classes/Chatterbox.BaseTab.html">Chatterbox.BaseTab</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Channel.html">Chatterbox.Channel</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Chatbook.html">Chatterbox.Chatbook</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Control.html">Chatterbox.Control</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Feed.html">Chatterbox.Feed</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Navigation.html">Chatterbox.Navigation</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Pager.html">Chatterbox.Pager</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Popup.html">Chatterbox.Popup</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.html">Chatterbox.Settings</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Config.html">Chatterbox.Settings.Config</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.html">Chatterbox.Settings.Item</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Checkbox.html">Chatterbox.Settings.Item.Checkbox</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Form.html">Chatterbox.Settings.Item.Form</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Form.Checkbox.html">Chatterbox.Settings.Item.Form.Checkbox</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Form.Colour.html">Chatterbox.Settings.Item.Form.Colour</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Form.Field.html">Chatterbox.Settings.Item.Form.Field</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Form.Radio.html">Chatterbox.Settings.Item.Form.Radio</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Items.html">Chatterbox.Settings.Item.Items</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Item.Radio.html">Chatterbox.Settings.Item.Radio</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.Settings.Page.html">Chatterbox.Settings.Page</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.UI.html">Chatterbox.UI</a></li>
    
        <li><a href="/wsc/api/classes/Chatterbox.UI.sound.html">Chatterbox.UI.sound</a></li>
    
        <li><a href="/wsc/api/classes/dAmn.avatar.html">dAmn.avatar</a></li>
    
        <li><a href="/wsc/api/classes/dAmn.Extension.html">dAmn.Extension</a></li>
    
        <li><a href="/wsc/api/classes/dAmn.Stash.html">dAmn.Stash</a></li>
    
        <li><a href="/wsc/api/classes/dAmn.TablumpParser.html">dAmn.TablumpParser</a></li>
    
        <li><a href="/wsc/api/classes/dAmn.TablumpString.html">dAmn.TablumpString</a></li>
    
        <li><a href="/wsc/api/classes/EventEmitter.html">EventEmitter</a></li>
    
        <li><a href="/wsc/api/classes/jQuery.plugin.html">jQuery.plugin</a></li>
    
        <li><a href="/wsc/api/classes/StringSet.html">StringSet</a></li>
    
        <li><a href="/wsc/api/classes/template.html">template</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Channel.html">wsc.Channel</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Client.html">wsc.Client</a></li>
    
        <li><a href="/wsc/api/classes/wsc.defaults.Extension.html">wsc.defaults.Extension</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Flow.html">wsc.Flow</a></li>
    
        <li><a href="/wsc/api/classes/wsc.MessageParser.html">wsc.MessageParser</a></li>
    
        <li><a href="/wsc/api/classes/wsc.MessageString.html">wsc.MessageString</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Middleware.html">wsc.Middleware</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Packet.html">wsc.Packet</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Protocol.html">wsc.Protocol</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Protocol.LogMessage.html">wsc.Protocol.LogMessage</a></li>
    
        <li><a href="/wsc/api/classes/wsc.SocketIO.html">wsc.SocketIO</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Storage.html">wsc.Storage</a></li>
    
        <li><a href="/wsc/api/classes/wsc.Transport.html">wsc.Transport</a></li>
    
        <li><a href="/wsc/api/classes/wsc.WebSocket.html">wsc.WebSocket</a></li>
    
    </ul>
</nav>
        <div class="content">
            <h1 class="file-heading">File: src&#x2F;dAmn&#x2F;extension.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

&#x2F;**
 * The dAmn extension makes the client work with dAmn. This extension also implements
 * various other features to improve on the user experience.
 * 
 * @class dAmn.Extension
 * @constructor
 *&#x2F;
wsc.dAmn.Extension = function( client ) {

    client.settings.client = &#x27;dAmnClient&#x27;;
    client.settings.clientver = &#x27;0.3&#x27;;
    client.settings.domain = &#x27;deviantart.com&#x27;;
    client.settings.agent+= &#x27; wsc&#x2F;dAmn&#x2F;&#x27; + wsc.dAmn.VERSION;
    
    var storage = client.storage.folder(&#x27;dAmn&#x27;);
    storage.bds = storage.folder(&#x27;bds&#x27;);
    storage.emotes = storage.folder(&#x27;emotes&#x27;);
    storage.colours = storage.folder(&#x27;colours&#x27;);
    var settings = {
        &#x27;emotes&#x27;: {
            &#x27;on&#x27;: false,
            &#x27;emote&#x27;: []
        },
        &#x27;colours&#x27;: {
            &#x27;on&#x27;: false,
            &#x27;send&#x27;: false,
            &#x27;msg&#x27;: &#x27;000000&#x27;,
            &#x27;user&#x27;: &#x27;000000&#x27;
        }
    };
    
    settings.save = function(  ) {
        
        storage.emotes.set(&#x27;on&#x27;, settings.emotes.on);
        storage.colours.set(&#x27;on&#x27;, settings.colours.on);
        storage.colours.set(&#x27;send&#x27;, settings.colours.send);
        storage.colours.set(&#x27;msg&#x27;, settings.colours.msg);
        storage.colours.set(&#x27;user&#x27;, settings.colours.user);
        
    };
    
    settings.load = function(  ) {
    
        settings.emotes.on = (storage.emotes.get(&#x27;on&#x27;, &#x27;false&#x27;) == &#x27;true&#x27;);
        settings.colours.on = (storage.colours.get(&#x27;on&#x27;, &#x27;false&#x27;) == &#x27;true&#x27;);
        settings.colours.send = (storage.colours.get(&#x27;send&#x27;, &#x27;false&#x27;) == &#x27;true&#x27;);
        settings.colours.msg = storage.colours.get(&#x27;msg&#x27;, &#x27;&#x27;);
        settings.colours.user = storage.colours.get(&#x27;user&#x27;, &#x27;&#x27;);
    
    };
    
    settings.load();
    settings.save();
    
    client.protocol.extend_maps({
        &#x27;dAmnServer&#x27;: [&#x27;version&#x27;]
    });
    
    client.protocol.extend_messages({
        &#x27;dAmnServer&#x27;: [&#x27;&lt;span class=&quot;servermsg&quot;&gt;** Connected to dAmnServer {version} *&lt;&#x2F;span&gt;&#x27;, false, true ]
    });
    
    client.protocol.mparser = new wsc.dAmn.TablumpParser;
    
    client.flow.dAmnServer = client.flow.chatserver;
    
    client.exclude.add( &#x27;chat:devart&#x27; );
    client.exclude.add( &#x27;chat:damnidlers&#x27; );
    
    client.ui.middle( &#x27;user.hover&#x27;, function( data, done ) {
        data.avatar = wsc.dAmn.avatar.link(data.name, data.member.usericon);
        
        if( data.member.realname &amp;&amp; data.info.indexOf( data.member.realname ) == -1 )
            data.info.push(data.member.realname);
        
        if( data.member.typename &amp;&amp; data.info.indexOf( data.member.typename ) == -1 )
            data.info.push(data.member.typename);
        
        done( data );
    });
    
    client.ui.on( &#x27;settings.save&#x27;, settings.save );
    client.ui.on( &#x27;settings.close&#x27;, settings.load );
    
    client.ui.on( &#x27;log_whois.before&#x27;, function( event, ui ) {
        event.avatar = wsc.dAmn.avatar.link( event.raw.username, event.raw.usericon );
        event.username = event.raw.symbol + &#x27;&lt;b&gt;&lt;a href=&quot;http:&#x2F;&#x2F;&#x27; + event.raw.username + &#x27;.deviantart.com&#x2F;&quot;&gt;&#x27; + event.raw.username + &#x27;&lt;&#x2F;a&gt;&lt;&#x2F;b&gt;&#x27;;
        
        if( event.raw.realname )
            event.info.push(event.raw.realname);
        
        if( event.raw.typename )
            event.info.push(event.raw.typename);
    } );
    
    &#x2F;**
     * Implements the Data Sharing Protocol.
     * 
     * @method BDS
     *&#x2F;
    wsc.dAmn.BDS( client, storage.bds, settings );
    
    &#x2F;**
     * Implements Data Sharing Links. Links are private chats between two clients that
     * are used for exchanging information autonomously.
     *
     * @method BDS.Link
     *&#x2F;
    wsc.dAmn.BDS.Link( client, storage.bds, settings );
    
    &#x2F;**
     * Implements custom colours.
     * 
     * @method Colours
     *&#x2F;
    wsc.dAmn.Colours( client, storage.colours, settings );
    
    &#x2F;**
     * Implements custom emoticons.
     *
     * @method Emotes
     *&#x2F;
    wsc.dAmn.Emotes( client, storage.emotes, settings );
    
    &#x2F;**
     * Implements Sta.sh thumbnails.
     * 
     * @method Stash
     *&#x2F;
    wsc.dAmn.Stash( client, storage.emotes, settings );

};

    </pre>
</div>

        </div>
    </div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
<script src="/wsc/js/docs.js"></script>
</body>
</html>
